<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Creating a Windows Forms GUI with F#</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Creating a Windows Forms GUI with F#</h1>
</header>
<section data-field="subtitle" class="p-summary">
Windows Forms is not dead — it’s now more alive than it has been for years now that Microsoft announced they will support it in .NET Core…
</section>
<section data-field="body" class="e-content">
<section name="4c0c" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="3cc9" id="3cc9" class="graf graf--h3 graf--leading graf--title">Creating a Windows Forms GUI with F#</h3><figure name="6b93" id="6b93" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 559px; max-height: 800px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 143.1%;"></div><img class="graf-image" data-image-id="1*jAJoDLM4IRmo3EEls2IavA.jpeg" data-width="559" data-height="800" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*jAJoDLM4IRmo3EEls2IavA.jpeg"></div></figure><p name="3fb1" id="3fb1" class="graf graf--p graf-after--figure">Windows Forms is not dead — it’s now more alive than it has been for years now that Microsoft announced they will support it in <a href="https://blogs.msdn.microsoft.com/dotnet/2018/05/07/net-core-3-and-support-for-windows-desktop-applications/" data-href="https://blogs.msdn.microsoft.com/dotnet/2018/05/07/net-core-3-and-support-for-windows-desktop-applications/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">.NET Core 3.0</a>, and that you will be able to<a href="https://docs.microsoft.com/en-us/windows/uwp/xaml-platform/xaml-host-controls" data-href="https://docs.microsoft.com/en-us/windows/uwp/xaml-platform/xaml-host-controls" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"> embed “modern” UWP controls</a> in Forms apps.</p><p name="cbf7" id="cbf7" class="graf graf--p graf-after--p">Besides not being dead, it has other things going for it:</p><ul class="postList"><li name="d70c" id="d70c" class="graf graf--li graf-after--p">It’s easy to use from F#, as you’ll see from this post. WPF requires more complex adaptation work (e.g. there is a <a href="https://fsprojects.github.io/FsXaml/" data-href="https://fsprojects.github.io/FsXaml/" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">XAML type provider</a>), while Forms is pretty much straight .NET.</li><li name="bebe" id="bebe" class="graf graf--li graf-after--li">.NET Native (i.e. the “full” UWP stack) does not work with F# at all, and possibly never will — so it’s probably not going to be relevant to your choices.</li><li name="30d3" id="30d3" class="graf graf--li graf-after--li">Windows Forms uses the programming pattern familiar from Qt and other UI toolkits, so you can pretty much get going in a day.</li><li name="d92f" id="d92f" class="graf graf--li graf-after--li">It’s not a particularly good fit for “rich” or customized UI’s, but you are not writing those anyway. When you have someone paying you to do a rich UI for desktop, they are paying to do it on the Web.</li><li name="dfbd" id="dfbd" class="graf graf--li graf-after--li">It’s the real Native toolkit for Windows, so the applications can be very small. An application that does something can happen in 20kB (without F# of course, F# adds ca. 3MB of weight).</li><li name="afc7" id="afc7" class="graf graf--li graf-after--li">Windows Forms, unlike WPF or UWP, has a cross platform story and can be run in Mono under Linux/Mac.</li></ul><h4 name="30bd" id="30bd" class="graf graf--h4 graf-after--li">With F# you say?</h4><p name="01f0" id="01f0" class="graf graf--p graf-after--h4">The problem with GUI programming with F# is that UI design tools are written for C# and VB programmers. The recommended approach has usually been to:</p><ul class="postList"><li name="ed1f" id="ed1f" class="graf graf--li graf-after--p">Create the GUI logic in C#, using the Forms UI Designer.</li><li name="6ee4" id="6ee4" class="graf graf--li graf-after--li">Use F# to make libraries and call out to them from the GUI.</li></ul><p name="a766" id="a766" class="graf graf--p graf-after--li">The obvious problem with this is that you don’t really want to use C# more than necessary, and want to keep language context switching to the minimum — not to mention that you are limited to constructs that are well supported on C# side on the boundary.</p><p name="6b7b" id="6b7b" class="graf graf--p graf-after--p">Another approach, probably only appropriate for seasoned Forms developers, is to write everything in F# without using the Designer. This is outlined at least in the (excellent) “<em class="markup--em markup--p-em">Expert F#</em>” book, if you are curious how to do it.</p><p name="9066" id="9066" class="graf graf--p graf-after--p">The alternative approach I’m proposing here is to also write all the GUI logic in F#, only dropping to the C# side when you want to move things around in the Forms Designer. Your main entry point is the F# application, which then instantiates the main form (and subsequent forms). The forms register all their UI components with a “behind” class, which then binds the event handlers and implements all that hairy GUI logic in a language that is more aesthetically pleasing (that’s F#, if you are new here).</p><p name="31f4" id="31f4" class="graf graf--p graf-after--p">I’ll take a shortcut and use a <a href="https://github.com/vivainio/scaffer-templates" data-href="https://github.com/vivainio/scaffer-templates" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Scaffer template</a> to create the app skeleton:</p><figure name="90b8" id="90b8" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 686px; max-height: 483px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 70.39999999999999%;"></div><img class="graf-image" data-image-id="1*zhmw1J5UeS3fId7uN_-xQw.png" data-width="686" data-height="483" src="https://cdn-images-1.medium.com/max/800/1*zhmw1J5UeS3fId7uN_-xQw.png"></div></figure><p name="2b39" id="2b39" class="graf graf--p graf-after--figure">Yikes! That was a lot of stuff. Fear, not, you only ever need to care about few of them. If you click through the files, you’ll notice that:</p><ul class="postList"><li name="6609" id="6609" class="graf graf--li graf-after--p">MathManDesign is a project (DLL) written in C#. That’s the one you’ll open in VS and click around the Designer.</li><li name="ef5a" id="ef5a" class="graf graf--li graf-after--li">MathManMain is the “main” application (“EXE”). It contains the entry point which bootstraps Windows Forms, instantiates the MathManForm and hooks up the “behind” class. It takes a project reference to MathManDesign project, but MathManDesign does not have any kind of reference to MathManMain. Therefore, you can go wild in using F# constructs that have usability issues when exposed to C# (e.g. DU’s). This dependency “inversion” is done by <a href="https://github.com/vivainio/TrivialBehinds" data-href="https://github.com/vivainio/TrivialBehinds" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">TrivialBehinds</a>, a micro-DI-library available in nuget.</li></ul><p name="89c8" id="89c8" class="graf graf--p graf-after--li">When you build and launch the application, you’ll see the minimal default functionality in action:</p><figure name="6c9d" id="6c9d" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 301px; max-height: 112px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 37.2%;"></div><img class="graf-image" data-image-id="1*_vT2FfVc10uxKW_SzxV36g.png" data-width="301" data-height="112" src="https://cdn-images-1.medium.com/max/800/1*_vT2FfVc10uxKW_SzxV36g.png"></div></figure><p name="ae89" id="ae89" class="graf graf--p graf-after--figure">(to verify the behavior, I recommend clicking the button a few times and observing how the number after “Lorem ipsum“ in the label increments on each click).</p><p name="69cd" id="69cd" class="graf graf--p graf-after--p">It looks like this in the designer (double-click on MathManForm.cs to see the Design view):</p><figure name="1112" id="1112" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 373px; max-height: 178px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 47.699999999999996%;"></div><img class="graf-image" data-image-id="1*VcBCTfXg-N9bVWorBO3SqA.png" data-width="373" data-height="178" src="https://cdn-images-1.medium.com/max/800/1*VcBCTfXg-N9bVWorBO3SqA.png"></div></figure><p name="5601" id="5601" class="graf graf--p graf-after--figure">And press f7 to get to the code:</p><figure name="1135" id="1135" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/vivainio/c23a7545e613674e5a4553b4976dbad6.js"></script></figure><p name="405a" id="405a" class="graf graf--p graf-after--figure">After editing the form in the designer, you’ll add the new controls that it created in the MathManUi class. This is the <strong class="markup--strong markup--p-strong">only </strong>C# code you’ll need to keep up to date (of course it needs to be added for every Form you create). You can copy-paste the control declaration from MathManForm.Designer.cs.</p><p name="cbe8" id="cbe8" class="graf graf--p graf-after--p"><em class="markup--em markup--p-em">Update: </em>you can replace this boilerplate by CreateComponentBehind, if you want to expose the whole MathManForm instead of of MathManUi. In that case you need to make the controls public:</p><figure name="6736" id="6736" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/vivainio/b33f3c5ef19fef6584eb080171f34a64.js"></script></figure><p name="a959" id="a959" class="graf graf--p graf-after--figure">Now, let’s take a peek at the F# code running it all:</p><figure name="78a5" id="78a5" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/vivainio/e3831fe36468c218d19b51af266bfc4d.js"></script></figure><p name="0286" id="0286" class="graf graf--p graf-after--figure">That’s it!</p><p name="0ac4" id="0ac4" class="graf graf--p graf-after--p">The first lines of main are standard Windows Forms bootstrap code. Then we instantiate the Form and start the application. The instantiation of the form instantiates the “behind” we registered in registerBehinds() function.</p><h4 name="ddae" id="ddae" class="graf graf--h4 graf-after--p">Doing it from scratch</h4><p name="a806" id="a806" class="graf graf--p graf-after--h4">Warning: stop reading if you are already bored.</p><p name="3dd9" id="3dd9" class="graf graf--p graf-after--p">I “cheated” a bit by using a template — because some boring work went into getting it working. For the posterity, here’s what was needed to get that F# application off the ground:</p><ul class="postList"><li name="0050" id="0050" class="graf graf--li graf-after--p">Create a solution</li><li name="0c93" id="0c93" class="graf graf--li graf-after--li">Create the F# application as “Console application” and reference Windows.Forms and System.Drawing from there.</li><li name="d124" id="d124" class="graf graf--li graf-after--li">Set the application type of the F# application to WinExe (otherwise you’ll get that empty terminal when running the application)</li><li name="36b1" id="36b1" class="graf graf--li graf-after--li">Create the Design project, in VS 2017 “new project wizard” it’s “Windows Forms Control Library (.NET Framework)”.</li><li name="a7d1" id="a7d1" class="graf graf--li graf-after--li">The .NET Framework to use should be .NET Framework 4.7.2, because <a href="https://docs.microsoft.com/en-us/dotnet/framework/winforms/high-dpi-support-in-windows-forms" data-href="https://docs.microsoft.com/en-us/dotnet/framework/winforms/high-dpi-support-in-windows-forms" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">font rendering will be fuzzy on Windows 10</a> on 4.6 series and older.</li><li name="b3a9" id="b3a9" class="graf graf--li graf-after--li">In order to fix font rendering, I had to modify App.config (check the link above), and create a manifest in the F# application. To do that, I just did “Add manifest” on the Design project and copied it over to F# application side.</li><li name="781a" id="781a" class="graf graf--li graf-after--li">Since you’ll have multiple projects, it’s good idea to migrate to Paket.</li><li name="19ad" id="19ad" class="graf graf--li graf-after--li">Add a nuget dependency to TrivialBehinds to both projects. You can probably get similar behavior with “actual” DI libraries (get class X that supports handling data package Y), but I couldn’t be bothered to add one of those heavy injectors here.</li></ul><p name="a7af" id="a7af" class="graf graf--p graf-after--li graf--trailing">The skeleton code is at <a href="https://github.com/vivainio/FSharpFormsSkeleton" data-href="https://github.com/vivainio/FSharpFormsSkeleton" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">https://github.com/vivainio/FSharpFormsSkeleton</a> — I’ll probably keep it up to date and modify the template if/when needs arise. If you are using that instead of Scaffer, you need to do some IDE legwork to rename those classes.</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@vivainio" class="p-author h-card">Ville M. Vainio</a> on <a href="https://medium.com/p/968b3ae75a82"><time class="dt-published" datetime="2018-07-14T20:50:43.213Z">July 14, 2018</time></a>.</p><p><a href="https://medium.com/@vivainio/creating-a-windows-forms-gui-with-f-968b3ae75a82" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on July 1, 2019.</p></footer></article></body></html>